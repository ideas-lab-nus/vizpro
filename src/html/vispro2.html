<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">


    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://d3js.org/d3-path.v1.min.js"></script>
    <script src="https://d3js.org/d3-shape.v1.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.9.0/math.js"></script>

    </script>


    <style type="text/css">
        svg {
            border: solid 1px #aaa;
        }

        #checks {
            margin: 10px;
        }

        text {
            /* pointer-events: none; */
            user-select: none;
            font-family: monospace;

        }

        .nodeLog {
            font-size: small;
            font-family: monospace;
            pointer-events: none;
        }

        .component {
            /* pointer-events: none; */

        }


        input:focus,
        select:focus,
        textarea:focus,
        button:focus {
            outline: none;
        }

        rect:focus{
            outline:none;
        }

        .output {
            font-family: monospace;
            font-size: small;
            color: white;
        }

        .input {
            font-family: monospace;
            font-size: small;
        }

        .nodetitle {
            font-family: monospace;
            font-size: 13.2px;
            font-weight: bold;
            pointer-events: none;
        }


        div#someData {
            padding: 8px;
            padding-top: 25px;
            /* padding: 6px; */
            font-size: x-small;
            font-family: monospace;
        }




        circle {
            cursor: pointer;
        }

        div#PropertiesBarSelector {
            width: 3px;
            /* height: 100%; */
            position: fixed;
            right: 201px;
            background-color: #969696;
            border-left: 1px solid #efefef;
            box-shadow: inset 1px 0px 2px #565656;
            height: 100%;
            top: 0px;
            cursor: ew-resize;
        }

        div#PropertiesBar {
            width: 200px;
            background-color: #eaeaea;
            position: fixed;
            right: 0px;
            top: 0px;
            height: 100%;
        }

        div#mainGrid {
            position: absolute;
            top: 0px;
            left: 0px;
        }

        div#mainGrid {
            background-color: #e4e4e4;
            background-image: url(https://www.freeiconspng.com/uploads/white-grid-png-29.png);
            /* background-size: 20%; */
        }

        div#textAreaBox {
            position: absolute;
            top: 0px;
            left: 0px;
            opacity: 0.8;
        }

        div#optionlistBox {
            position: absolute;
            top: 0px;
            left: 0px;
            opacity: 0.8;
        }

        select#optionListSelectItems {
            background: white;
            opacity: 1;
            font-family: monospace;
            font-weight: bold;
            border: 1px solid black;
            border-radius: 3px;
        }

h5 {
    font-family: monospace;
    margin-top: 9px;
    margin-bottom: 4px;
    text-align: center;
}
    </style>
    <title>Document</title>
</head>

<body>
    <div class="ui-designer-grid" id="mainGrid">
        <svg height="6000" width="6000">
            <defs>
                <filter id="f2" x="-40" y="-40" width="150%" height="150%" filterUnits="userSpaceOnUse">
                    <feOffset result="offOut" in="SourceGraphics" dx="0" dy="0" />
                    <feGaussianBlur result="blurOut" in="offOut" stdDeviation="1" />
                    <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
                </filter>
            </defs>
            <!-- <rect width="90" height="90" stroke="green" stroke-width="3"
            fill="yellow" filter="url(#f2)" /> -->
        </svg>
    </div>
    <div id="textAreaBox" style="display:none"><textarea id="TextAreaSelector"style="background-color:rgba(255, 255, 255, 0.48)"></textarea></div>
    <div id="optionlistBox">
            <select id="optionListSelectItems" style="display:none">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                    <option value="opel">Opel</option>
                    <option value="audi">Audi</option>
            </select>
    </div>
    <div id="PropertiesBar">
        <div id="definedComp"></div>
        <div id="inputsComp">
            <h5>Data Inputs</h5>
                <button id="addSlider">Add Slider</button><br>
                <button id="addString">Add String</button><br>
                <button id="addToggle">Add Boolean</button><br>
                <button id="addOptionList">Add Option List</button><br>

            </div>
        


        <div id="someData">SourceGraphic

        </div>
    </div>
    <div id="PropertiesBarSelector">


    </div>
    <script>
        allComp = []
        allEdges = []
        comp_input_edges = {}
        comp_output_edges = {}
        edge_comp_matrix = {} // {"from":"", "to":"", "from_id":00, "to_id":00} is pushed to once the edge is created. 

        var fromCircle = addCircle();
        var toCircle = addCircle();

        function uuidv4(ini) {
            return ini + 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0,
                    v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function addEdge(from, to, fromComp, toComp) {
            initLink = {
                "GUID": uuidv4("E"),
                "path": null,
                "X1": 0,
                "Y1": 0,
                "X2": 10,
                "Y2": 10,
                "from": from,
                "to": to,
                "fromComp": fromComp,
                "toComp": toComp
            }

            return initLink;

        }

        function addCircle() {
            initCircle = {
                "GUID": uuidv4("C"),
                "element": null,
                "CX": 0,
                "CY": 0,
                "Comp": null,
                "type": "data",
                "path": null,
            }

            return initCircle;
        };



        Input = {
            "id": 0,
            "circle": null,
            "type": "input",
            "Name": "Input1",
            "ShortName": "X",
            "Description": "input1",
            "Message": "short description",
            "type": "item",
            "datatype": "int",
            "value": 0,
        }
            Output = {
                "id": 0,
                "circle": null,
                "type": "output",
                "Name": "output1",
                "ShortName": "A",
                "Description": "output1",
                "Message": "short description",
                "type": "item",
                "datatype": "int",
                "value": 0,
            }

        function addSlider(guid, min = 0, max = 100, step = 1.0) {
            initSlider = {
                "GUID": guid,
                "X": 0,
                "Y": 0,
                "width": 150,
                "height": 30,
                "Name": "Slider",
                "ShortName": "Num",
                "Description": "Dummy Slider",
                "Message": "short description",
                "inputs":[],
                "min": min,
                "max": max,
                "value": 0,
                "step": step,
                "typeName": null,
                "selection": "selectable",
                "view": "visible", // hidden , disabled
                "fill": "#303952",
                "rect": null,
                "type":"slider"
                
            };

            return initSlider;
        }

        function addcomponent(guid, n_inputs = 4, n_outputs = 5, inputsIn = 5*["input"], outputsIn=5*["output"]) {
            inputs = []
            outputs = []
            //console.log(n_inputs)
            for (let index = 0; index < n_inputs; index++) {
                //console.log(inputsIn[index])
                inputs.push({
                    "id": index,
                    "circle": null,
                    "textObj": null,
                    "Name": "Input" + index.toString(),
                    "ShortName": inputsIn[index],
                    "Description": "input1",
                    "Message": "short description",
                    "type": "item",
                    "datatype": "int",
                    "value": 0,
                })

            }


            for (let index = 0; index < n_outputs; index++) {
                outputs.push({
                    "id": index,
                    "circle": null,
                    "textObj": null,
                    "Name": "Output" + index.toString(),
                    "ShortName": outputsIn[index],
                    "Description": "output",
                    "Message": "short description",
                    "type": "item",
                    "datatype": "int",
                    "value": 0,
                })

            }
            initComp = {
                "GUID": guid,
                "X": 0,
                "Y": 0,
                "width": 120,
                "height": 50,
                "Name": "Component",
                "ShortName": "Comp",
                "Description": "Dummy component",
                "Message": "short description",
                "numInputs": 3,
                "numOutputs": 2,
                "typeName": null,
                "logo": null,
                "type": "component",
                "state": "unbound",
                "selection": "selectable",
                "view": "visible", // hidden , disabled
                "fill": "#303952",
                "rect": null,
                "inputs": inputs,
                "outputs": outputs,
                "textValue":"",
                "log": {
                    "logText": " Log message output.. "
                },
                "optionListValues":{
                    "Ventus": "1",
                    "SDE2": 23,
                    "SDE3": 12.5,
                    "SDE4": true,
                    "BIZ2": "google",
                    "CLB": "hhl"
                }
            };

            return initComp;
        } //End of addcomponent

        var svgContainer = d3.select("svg");


/*
─────────────────────────────────────────────────────────────────────
─██████████████─██████████████─██████──────────██████─██████████████─
─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░██████████████░░██─██░░░░░░░░░░██─
─██░░██████████─██░░██████░░██─██░░░░░░░░░░░░░░░░░░██─██░░██████░░██─
─██░░██─────────██░░██──██░░██─██░░██████░░██████░░██─██░░██──██░░██─
─██░░██─────────██░░██──██░░██─██░░██──██░░██──██░░██─██░░██████░░██─
─██░░██─────────██░░██──██░░██─██░░██──██░░██──██░░██─██░░░░░░░░░░██─
─██░░██─────────██░░██──██░░██─██░░██──██████──██░░██─██░░██████████─
─██░░██─────────██░░██──██░░██─██░░██──────────██░░██─██░░██─────────
─██░░██████████─██░░██████░░██─██░░██──────────██░░██─██░░██─────────
─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░██──────────██░░██─██░░██─────────
─██████████████─██████████████─██████──────────██████─██████─────────
─────────────────────────────────────────────────────────────────────

*/

        $("div#definedComp").html(function()
        {
            somearr = ["Building", "Site:Location", "OSISoft Data"];
            text = "<h5>User Defined Components</h5>";
            somearr.forEach(element => {
                text += '<button id="addComp" type="'+element+'">'+element+'</button></br>'
                
            });
            text+="<hr>"
            return text;
        })
 
        $("button#addComp").on('click', function (e) {
            

            // somearr = ["Building", "Site:Location", "OSISoft Data"];
            allColors = ["#f6b93b","#e55039","#4a69bd","#60a3bc","#6a89cc","#fed330","#2bcbba","#26de81","#e74c3c","#95a5a6","#8e44ad","#34495e","#7f8c8d"];

            inputdict = {
                "Building":
                {
                    "color": "#e17055",
                    "inputs": ["_BuildingName", "_NorthAxis", "_Terrain", "_LoadsConvergenceToleranceValue", "_Temperature Convergence Tolerance Value", "_Solar Distribution", "_Maximum Number of Warmup Days", "_Minimum Number of Warmup Days"],
                    "longestInput": ["_BuildingName", "_NorthAxis", "_Terrain", "_LoadsConvergenceToleranceValue", "_Temperature Convergence Tolerance Value", "_Solar Distribution", "_Maximum Number of Warmup Days", "_Minimum Number of Warmup Days"].reduce(function(a, b) { 
                        return a.length > b.length ? a : b
                        }, ''),
                    "outputs": ["BuildingIDF_", "Log"],
                    "longestOutput": ["BuildingIDF_", "Log"].reduce(function(a, b) { 
                        return a.length > b.length ? a : b
                        }, ''),
                },
                "Site:Location":
                {
                    "color": "#636e72",
                    "inputs": ["_Name", "_Latitude", "_Longitude", "_Time Zone", "_Elevation"],
                    "longestInput": ["_Name", "_Latitude", "_Longitude", "_Time Zone", "_Elevation"].reduce(function(a, b) { 
                        return a.length > b.length ? a : b
                        }, ''),
                    "outputs": ["Site:locationIDF_", "Log_"],
                    "longestOutput": ["Site:locationIDF_", "Log_"].reduce(function(a, b) { 
                        return a.length > b.length ? a : b
                        }, ''),
                },
                "OSISoft Data":
                {
                    "color": "#00b894",
                    "inputs": ["_URL", "_ApiKey", "_From:YY-MM-DD-HH-mm-SS", "_To:YY-MM-DD-HH-mm-SS", "_Step"],
                    "longestInput": ["_URL", "_ApiKey", "_From:YY-MM-DD-HH-mm-SS", "_To:YY-MM-DD-HH-mm-SS", "_Step"].reduce(function(a, b) { 
                        return a.length > b.length ? a : b
                        }, ''),
                    "outputs": ["List of Timeseries Data_", "Log_"],
                    "longestOutput": ["List of Timeseries Data_", "Log_"].reduce(function(a, b) { 
                        return a.length > b.length ? a : b
                        }, ''),
                }
            }

            ThisComponentName = $(this).attr("type");
            var newcomp = addcomponent(uuidv4("C"), inputdict[ThisComponentName].inputs.length, inputdict[ThisComponentName].outputs.length, inputdict[ThisComponentName].inputs,  inputdict[ThisComponentName].outputs);


            //local title variables; Those should be later put in the visualization properties table. 
            one_character_width = 8;
            padding = 20;
            titleMargin = 30;
            titleMarginLeft = 30;

            //initial properties of the component ... Those should be later read from the table of components. 
            newcomp.fill = inputdict[ThisComponentName].color;//allColors[Math.floor(Math.random() * allColors.length)];
            newcomp.Name = ThisComponentName;
            newcomp.height = titleMargin + (Math.max(newcomp.inputs.length, newcomp.outputs.length + 1)) *padding;
            newcomp.width = (inputdict[ThisComponentName].longestInput.length + inputdict[ThisComponentName].longestOutput.length) * one_character_width + titleMarginLeft;
            
            var cont = svgContainer.append("g")
                .attr("class", "component")
                .attr("id", newcomp.GUID);

            var node = cont
                .append("g")
                .attr("class", newcomp.type + " " + newcomp.state + " " + newcomp.selection + " " + newcomp
                    .view + " " + newcomp.GUID)
                .attr("id", "comp-" + newcomp.GUID)
                .attr("transform", () => {
                    return "translate(" + Math.random() * 500 + ", " + Math.random() * 500 + ")";
                })


                var InputGroup = node.append('g');
            for (let index = 0; index < newcomp.inputs.length; index++) {
                var inp = InputGroup.append('circle').lower()
                    .attr("cx", "0")
                    .attr("cy", (index * padding + titleMargin).toString())
                    .attr("fill", newcomp.fill)//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "inputCirViual" + newcomp.GUID + "_" + index)
                    .attr("class", "inputCirVisual " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.inputs[index].circle = addCircle();
                        newcomp.inputs[index].circle.element = this;
                        newcomp.inputs[index].circle.CX = 0;
                        newcomp.inputs[index].circle.CY = (index * padding + titleMargin);
                        newcomp.inputs[index].type = "input";
                        return "input";
                    });
            }

                var InputGroup = node.append('g');
            for (let index = 0; index < newcomp.inputs.length; index++) {
                var inp = InputGroup.append('circle').lower()
                    .attr("cx", "0")
                    .attr("cy", (index * padding + titleMargin).toString())
                    .attr("fill", "white")//newcomp.fill)
                    .attr("r", "10")
                    .attr("fill-opacity", "0.02")
                    .attr("stroke", "black")
                    .attr("stroke-width", "0")
                    .attr("id", "inputCir" + newcomp.GUID + "_" + index)
                    .attr("class", "inputCir " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.inputs[index].circle = addCircle();
                        newcomp.inputs[index].circle.element = this;
                        newcomp.inputs[index].circle.CX = 0;
                        newcomp.inputs[index].circle.CY = (index * padding + titleMargin);
                        newcomp.inputs[index].type = "input";
                        return "input";
                    });
            }

            var OutputGroup = node.append('g');
            for (let index = 0; index < newcomp.outputs.length; index++) {
                var out = OutputGroup.append('circle')
                    .attr("cx", newcomp.width)
                    .attr("cy", (index * padding + titleMargin).toString())
                    .attr("fill", newcomp.fill)//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "outputCirVisual" + newcomp.GUID + "_" + index)
                    .attr("class", "outputCirVisual " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.outputs[index].circle = this;
                        newcomp.outputs[index].type = "output";
                        // //////console.log(newcomp.outputs[index]);
                        return "output";
                    }).lower();
            }

            var OutputGroup = node.append('g');
            for (let index = 0; index < newcomp.outputs.length; index++) {
                var out = OutputGroup.append('circle')
                    .attr("cx", newcomp.width)
                    .attr("cy", (index * padding + titleMargin).toString())
                    .attr("fill", "white")
                    .attr("fill-opacity", "0.02")//newcomp.fill)
                    .attr("r", "10")
                    .attr("stroke", "black")
                    .attr("stroke-width", "0")
                    .attr("id", "outputCir" + newcomp.GUID + "_" + index)
                    .attr("class", "outputCir " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.outputs[index].circle = this;
                        newcomp.outputs[index].type = "output";
                        // //////console.log(newcomp.outputs[index]);
                        return "output";
                    }).lower();
            }

            var Dummyrect = node.append('rect')
                .attr("class", "CompBodyDummy " + newcomp.GUID)
                .attr("id", "dummyRect_"+newcomp.GUID)
                .attr("rx", "3")
                .attr("ry", "3")
                .attr("filter", "url(#f2")
                // .attr("stroke-width", "1")
                // .attr("stroke", "black")
                .attr("width",newcomp.width)
                .attr("height", newcomp.height)
                .attr("fill", newcomp.fill)
                .on("mousedown",()=>
                {
                    rectType = "component";
                    ////console.log(rectType);
                    
                })

            var cirGroup = node.append('g')
                .attr("transform", () => {
                    x = newcomp.width;
                    y = newcomp.height;
                    return "translate(" + (x).toString() + "," + (y - 10).toString() + ")";
                });

            var cir = cirGroup.append("circle")
                .attr("class", "log " + newcomp.GUID)
                .attr("id", "log-" + newcomp.GUID)
                .attr("r", "5")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", "2")
                .on('mouseover', () => {
                    d3.select("#nodeLog" + newcomp.GUID).style("display", "block");
                })
                .on('mouseout', () => {
                    d3.select("#nodeLog" + newcomp.GUID).style("display", "none");
                });

            var log = cirGroup.append("text")
                .attr("id", "nodeLog" + newcomp.GUID)
                .attr("class", "nodeLog " + newcomp.GUID)
                .attr("transform", "translate(10, 10)")
                .text(newcomp.log.logText)
                .attr("fill", "black")
                .style("display", "none");


            var Titlegroup = node.append("g")
                .attr("transform", () => {
                    return "translate(0, 15)";
                });


            var Title = Titlegroup.append("text")
                .attr("class", "nodetitle node_title" + newcomp.GUID)
                .text(newcomp.Name)
                .attr("fill", "white")
                .attr("transform", "translate(" + (newcomp.width/2.0 - (newcomp.Name.length*4.0)) + ", 0)")

                var InputGroupText = node.append('g');

                for (let index = 0; index < newcomp.inputs.length; index++) {
                    var inptext = InputGroupText.append('text')
                        .attr("id", "input-" + newcomp.GUID + "_" + index)
                        .attr("class", "inputTxt " + newcomp.GUID + " " + index)
                        .attr("transform", "translate(" + 10 +
                            " , " + (index * padding + titleMargin + 5).toString() + ")")
                        .text(newcomp.inputs[index].ShortName)
                        .attr("fill", "white")
                        .attr("type", function () {
                            newcomp.inputs[index].textObj = this;
                            return "input";
                        });

                    }
                            
            var OutputGroupText = node.append('g');
            for (let index = 0; index < newcomp.outputs.length; index++) {
                var outtext = OutputGroupText.append('text')
                    .attr("id", "output-" + newcomp.GUID + "_" + index)
                    .attr("class", "outputTxt " + newcomp.GUID + " " + index)
                    .attr("transform", "translate(" + (newcomp.width - (newcomp.outputs[index].ShortName
                            .length * 8)-5).toString() + " , " + (index * padding + titleMargin + 5).toString() +
                        ")")
                    .text(newcomp.outputs[index].ShortName)
                    .attr("fill", "white")
                    .attr("type", function () {
                        newcomp.outputs[index].circle = this;
                        newcomp.outputs[index].type = "output";

                        return "output";
                    })
                    .attr("type", function () {
                        newcomp.outputs[index].textObj = this;


                        // //////console.log(newcomp.outputs[index]);
                        return "output";
                    });
            }

            var rect = node.append('rect')
                .attr("class", "CompBody " + newcomp.GUID)
                .attr("id", newcomp.GUID)
                .attr("rx", "3")
                .attr("ry", "3")

                .attr("width", newcomp.width)
                .attr("height", newcomp.height)
                .attr("fill", newcomp.fill)
                .attr("fill-opacity", "0.01")
                .on("mouseover", function () {
                    newcomp.rect = this;
                    d3.select(newcomp.rect)
                        .attr("cursor", "pointer");
                })
                .on("mouseout", function () {
                    newcomp.rect = this;
                    d3.select(newcomp.rect).attr("fill", newcomp.fill)
                })
                .on("dblclick", () => {
                })
                .on("mousedown",()=>
                {
                    rectType = "component";
                    conosle.log(rectType);
                });
            allComp.push(newcomp);
            comp_input_edges[newcomp.GUID] = new Array(newcomp.inputs.length);

            ////console.log(newcomp.GUID)
            comp_output_edges[newcomp.GUID] = new Array(newcomp.outputs.length);




            var mainGrid = d3.select("#mainGrid");
            var allcomp = d3.selectAll("rect.CompBody")
                .on('mousedown', function (d, i) {
                    var coordinates = d3.mouse(this);
                    componentClickX = coordinates[0];
                    componentClickY = coordinates[1];


                    clicked = true;
                    var pos = $("#comp-" + this.id).attr("transform").split("translate(")[1].replace(")",
                        "").split(",").map(function (item) {
                        return parseFloat(item, 10);
                    });
                    dragX = pos[0] + x;
                    dragY = pos[1] + y;

                    startDrag = true;
                    clickedId = this.id;


                    rectType = "component";
                    ////console.log(rectType);
                    
                })


                handleEdgeInitialization();
                handleComponentSelection()

        });


/*
                    ───────────────────────────────────────────────────────────────────────────────────────────
                    ─██████████████─██████─────────██████████─████████████───██████████████─████████████████───
                    ─██░░░░░░░░░░██─██░░██─────────██░░░░░░██─██░░░░░░░░████─██░░░░░░░░░░██─██░░░░░░░░░░░░██───
                    ─██░░██████████─██░░██─────────████░░████─██░░████░░░░██─██░░██████████─██░░████████░░██───
                    ─██░░██─────────██░░██───────────██░░██───██░░██──██░░██─██░░██─────────██░░██────██░░██───
                    ─██░░██████████─██░░██───────────██░░██───██░░██──██░░██─██░░██████████─██░░████████░░██───
                    ─██░░░░░░░░░░██─██░░██───────────██░░██───██░░██──██░░██─██░░░░░░░░░░██─██░░░░░░░░░░░░██───
                    ─██████████░░██─██░░██───────────██░░██───██░░██──██░░██─██░░██████████─██░░██████░░████───
                    ─────────██░░██─██░░██───────────██░░██───██░░██──██░░██─██░░██─────────██░░██──██░░██─────
                    ─██████████░░██─██░░██████████─████░░████─██░░████░░░░██─██░░██████████─██░░██──██░░██████─
                    ─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░██─██░░░░░░░░████─██░░░░░░░░░░██─██░░██──██░░░░░░██─
                    ─██████████████─██████████████─██████████─████████████───██████████████─██████──██████████─
*/


        $("button#addSlider").on('click', function (e) {
            ////console.log("Adding Slider ....")
            var newSlider = addSlider(uuidv4("S"), 0, 100, 1.0);
            ////console.log(newcomp)

            allColors = ["#f6b93b","#e55039","#4a69bd","#60a3bc","#6a89cc","#fed330","#2bcbba","#26de81", "#e74c3c","#95a5a6", "#8e44ad","#34495e","#7f8c8d"]
            newSlider.fill = "#bdc4c8";
            newSlider.Name = "slider";
            one_character_width = 8;
            padding = 20;
            titleMargin = 30;
            titleMarginLeft = 5;
            newSlider.height = 20;
            newSlider.width = 250;

            var cont = svgContainer.append("g")
                .attr("class", "slider")
                .attr("id", newSlider.GUID);

            var node = cont
                .append("g")
                .attr("class", "SliderGroup" + " " + newSlider.selection + " " + newSlider
                    .view + " " + newSlider.GUID)
                .attr("id", "comp-" + newSlider.GUID)
                .attr("transform", () => {
                    return "translate(" + Math.random() * 500 + ", " + Math.random() * 500 + ")";
                }).on("mousedown", ()=>
                {
                    rectType = "slider";
                    //console.log('hello world');
                });

                var OutputGroup = node.append('g');

                var out = OutputGroup.append('circle')
                    .attr("cx", newSlider.width)
                    .attr("cy", "10")
                    .attr("fill", "gray")//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "outputCir" + newSlider.GUID)
                    .attr("class", "outputCir " + newSlider.GUID +" 0" );

                var rect = node.append('rect')
                    .attr("class", "CompBody " + newSlider.GUID)
                    .attr("id", newSlider.GUID)
                    .attr("rx", "3")
                    .attr("ry", "3")
                    .attr("filter", "url(#f2")
                    .attr("stroke-width", "1")
                    .attr("stroke", "#3a4c69")
                    .attr("width", newSlider.width)
                    .attr("height", newSlider.height)
                    .attr("fill", newSlider.fill)
                    // .attr("filter", "url('#svgshadow')")
                    .on("mouseover", function () {
                        newSlider.rect = this;
                        d3.select(newSlider.rect)
                            // .attr("fill", "#303952")
                            .attr("cursor", "pointer");
                    })
                    .on("mouseout", function () {
                        newSlider.rect = this;
                        d3.select(newSlider.rect).attr("fill", newSlider.fill)
                    })
                    .on("dblclick", () => {
                        ////console.log("You dobule clicked me ");
                    })
                    .on("mousedown", ()=>
                    {
                        //console.log('hello world');
                        rectType = "slider";
                        
                    });

            
                var ValueTextGroup = node.append("g")
                .attr("transform", ()=>
                {
                    return ("translate(-80, 0)")
                });

            var ValueTextRect = ValueTextGroup.append("rect")
            .attr("cx", "0")
            .attr("cy","0")
            .attr("rx", "3")
            .attr("ry", "3")
            .attr("fill", "black")
            .attr("width", "80")
            .attr("height", "20")
            .attr("opacity", "0.5");

            var ValueText = ValueTextGroup.append("text")
            .attr("id", "sliderValueText_"+newSlider.GUID)
            .attr("class", "sliderValueText "+newSlider.GUID)
            .attr("transform", "translate(2, 14)")
            .attr("fill", "white")
            .text(newSlider.value.toString());

            var Titlegroup = node.append("g")
                .attr("transform", () => {
                    return "translate(0, 15)";
                });

            var Title = Titlegroup.append("text")
                .attr("class", "sliderTitle slider_title" + newSlider.GUID)
                .text(newSlider.Name)
                .attr("fill", "white")
                .attr("transform", "translate(" + titleMarginLeft / 2.0 + ", 0)")

            var SlidingGroup = node.append("g")
                .attr("transform", "translate(60, 0)");

            var slidingRectContainer = SlidingGroup.append("rect")
                // .attr("fill", "#576579")
                .attr("height", "3")
                .attr("width", "185")
                .attr("rx", "2")
                .attr("ry", "2")
                .attr("transform", "translate(0, 8)")
                .attr("stroke", "#677184")

            var slidingline = SlidingGroup.append("line")
                .attr("x1", "2")
                .attr("y1", "11")
                .attr("x2", "184")
                .attr("y2", "11")
                // .attr("d", "M 0,0 L 190,0")
                .attr("stroke", "gray")
                .attr("stroke-width", "1")

            var slidingAnchor = SlidingGroup.append("rect")
                .attr("id", "SliderAnchor_" + newSlider.GUID)
                .attr("width", "10")
                .attr("height", "15")
                .attr("rx", "5")
                .attr("ry", "5")
                .attr("fill", "#3a4d69")
                .attr("transform", "translate(60, 3)")
                .on("mouseover", function () {
                    d3.select(this)
                        .attr("fill", "#536c94")
                        .attr("cursor", "pointer")
                        .attr("stroke", "black");
                })
                .on("mouseleave", function () {
                    d3.select(this)
                        .attr("fill", "#3a4d69")
                        .attr("stroke", "none");
                })
                .on("mousedown", function () {
                    sliderRectId = this.id;
                    SliderAnchorclicked = true;
                   
                })
                .on("mouseup", function () {
                    SliderAnchorclicked = false;
                });
            ////console.log(newSlider.GUID)
            comp_output_edges[newSlider.GUID] = new Array(1);
            comp_input_edges[newSlider.GUID] = new Array(1);

            allComp.push(newSlider);

            theRequiredSliderGroup = undefined;

            //Moving the slider body
            var allcomp = d3.selectAll("g.SliderGroup")
                .on('mousedown', function (d, i) {
                    theRequiredSliderGroup = this;
                    rectType = "slider";
                    ////console.log(rectType);
                });


                        var allcomp = d3.selectAll("rect.CompBody")
                .on('mousedown', function (d, i) {
                    var coordinates = d3.mouse(this);
                    componentClickX = coordinates[0];
                    componentClickY = coordinates[1];
                    clicked = true;
                    var pos = $("#comp-" + this.id).attr("transform").split("translate(")[1].replace(")",
                        "").split(",").map(function (item) {
                        return parseFloat(item, 10);
                    });
                    dragX = pos[0] ;
                    dragY = pos[1] ;

                    startDrag = true;
                    clickedId = this.id;
                })

                handleEdgeInitialization();
                handleComponentSelection();
        });

/*

───────────────────────────────────────────────────────────────────────────────────────────────────
─██████████████─██████████████─████████████████───██████████─██████──────────██████─██████████████─
─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░░░██───██░░░░░░██─██░░██████████──██░░██─██░░░░░░░░░░██─
─██░░██████████─██████░░██████─██░░████████░░██───████░░████─██░░░░░░░░░░██──██░░██─██░░██████████─
─██░░██─────────────██░░██─────██░░██────██░░██─────██░░██───██░░██████░░██──██░░██─██░░██─────────
─██░░██████████─────██░░██─────██░░████████░░██─────██░░██───██░░██──██░░██──██░░██─██░░██─────────
─██░░░░░░░░░░██─────██░░██─────██░░░░░░░░░░░░██─────██░░██───██░░██──██░░██──██░░██─██░░██──██████─
─██████████░░██─────██░░██─────██░░██████░░████─────██░░██───██░░██──██░░██──██░░██─██░░██──██░░██─
─────────██░░██─────██░░██─────██░░██──██░░██───────██░░██───██░░██──██░░██████░░██─██░░██──██░░██─
─██████████░░██─────██░░██─────██░░██──██░░██████─████░░████─██░░██──██░░░░░░░░░░██─██░░██████░░██─
─██░░░░░░░░░░██─────██░░██─────██░░██──██░░░░░░██─██░░░░░░██─██░░██──██████████░░██─██░░░░░░░░░░██─
─██████████████─────██████─────██████──██████████─██████████─██████──────────██████─██████████████─
───────────────────────────────────────────────────────────────────────────────────────────────────


*/

$("button#addString").on('click', function (e) {
            var newcomp = addcomponent(uuidv4("C"), 1, 1);

            allColors = [
                "#f6b93b",
                "#e55039",
                "#4a69bd",
                "#60a3bc",
                "#6a89cc",
                "#fed330",
                "#2bcbba",
                "#26de81",
                "#e74c3c",
                "#95a5a6",
                "#8e44ad",
                "#34495e",
                "#7f8c8d",
            ]
            newcomp.fill = "#fbedcc";
            newcomp.Name = "String Panel";
            one_character_width = 8;
            padding = 20;
            titleMargin = 30;
            titleMarginLeft = 30;
            newcomp.height = 100;//titleMargin + (Math.max(newcomp.inputs.length, newcomp.outputs.length + 1)) *padding;
            newcomp.type = "string";

            newcomp.width = 200;

            compPos = [Math.random() * 500, Math.random() * 500]
            var cont = svgContainer.append("g")
                .attr("class", "component")
                .attr("id", newcomp.GUID);

            var node = cont
                .append("g")
                .attr("class", newcomp.type + " " + newcomp.state + " " + newcomp.selection + " " + newcomp
                    .view + " " + newcomp.GUID)
                .attr("id", "comp-" + newcomp.GUID)
                .attr("transform", () => {
                    return "translate(" + compPos[0] + ", " + compPos[1] + ")";
                })

                var InputGroup = node.append('g');
            for (let index = 0; index < newcomp.inputs.length; index++) {
                var inp = InputGroup.append('circle').lower()
                    .attr("cx", "0")
                    .attr("cy", newcomp.height/2)
                    .attr("fill", "gray")//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "inputCir" + newcomp.GUID + "_" + index)
                    .attr("class", "inputCir " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.inputs[index].circle = addCircle();
                        newcomp.inputs[index].circle.element = this;
                        newcomp.inputs[index].circle.CX = 0;
                        newcomp.inputs[index].circle.CY = (index * padding + titleMargin);
                        newcomp.inputs[index].type = "input";
                        return "input";
                    });
            }


            var OutputGroup = node.append('g');
            for (let index = 0; index < newcomp.outputs.length; index++) {
                var out = OutputGroup.append('circle')
                    .attr("cx", newcomp.width)
                    .attr("cy", newcomp.height/2)
                    .attr("fill", "gray")//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "outputCir" + newcomp.GUID + "_" + index)
                    .attr("class", "outputCir " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.outputs[index].circle = this;
                        newcomp.outputs[index].type = "output";
                        // //////console.log(newcomp.outputs[index]);
                        return "output";
                    }).lower();
            }

            var Dummyrect = node.append('rect')
                .attr("class", "CompBodyDummy " + newcomp.GUID)
                .attr("id", "dummyRect_"+newcomp.GUID)
                .attr("rx", "3")
                .attr("ry", "3")
                .attr("filter", "url(#f2")
                .attr("stroke-width", "1")
                .attr("stroke", "black")
                .attr("width", newcomp.width)
                .attr("height", newcomp.height)
                .attr("fill", newcomp.fill)

            

            var cirGroup = node.append('g')
                .attr("transform", () => {
                    x = newcomp.width;
                    y = newcomp.height;
                    return "translate(" + (x).toString() + "," + (y - 10).toString() + ")";
                });

            var cir = cirGroup.append("circle")
                .attr("class", "log " + newcomp.GUID)
                .attr("id", "log-" + newcomp.GUID)
                .attr("r", "5")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", "2")
                .on('mouseover', () => {
                    d3.select("#nodeLog" + newcomp.GUID).style("display", "block");
                })
                .on('mouseout', () => {
                    d3.select("#nodeLog" + newcomp.GUID).style("display", "none");
                });

            var log = cirGroup.append("text")
                .attr("id", "nodeLog" + newcomp.GUID)
                .attr("class", "nodeLog " + newcomp.GUID)
                .attr("transform", "translate(10, 10)")
                .text(newcomp.log.logText)
                .attr("fill", "black")
                .style("display", "none");


            var Titlegroup = node.append("g")
                .attr("transform", () => {
                    return "translate(0, 15)";
                });


            var Title = Titlegroup.append("text")
                .attr("class", "nodetitle node_title" + newcomp.GUID)
                .text(newcomp.Name)
                .attr("fill", "black")
                .attr("transform", "translate(" + (newcomp.width/2.0 - (newcomp.Name.length*4.0)).toString() +", 0)")
            
            newcomp.textValue = "google.";
            var textbody = node.append('text')
            .attr("id", "textbody_"+newcomp.GUID)
            .attr("class", "textbody "+ newcomp.GUID)
            .text(newcomp.textValue)
            .attr("transform", "translate(5, 30)")
            .attr("fill", "gray")
            .attr("width", newcomp.width);

            var rect = node.append('rect')
                .attr("class", "CompBody " + newcomp.GUID)
                .attr("id", newcomp.GUID)
                .attr("rx", "3")
                .attr("ry", "3")
                .attr("width", newcomp.width)
                .attr("height", newcomp.height)
                .attr("fill", newcomp.fill)
                .attr("fill-opacity", "0.01")
                .on("mouseover", function () {
                    newcomp.rect = this;
                    d3.select(newcomp.rect)
                        .attr("cursor", "pointer");
                })
                .on("mouseout", function () {
                    newcomp.rect = this;
                    d3.select(newcomp.rect).attr("fill", newcomp.fill)
                })

            allComp.push(newcomp);
            comp_input_edges[newcomp.GUID] = new Array(newcomp.inputs.length);

            ////console.log(newcomp.GUID)
            comp_output_edges[newcomp.GUID] = new Array(newcomp.outputs.length);




            var mainGrid = d3.select("#mainGrid");
            var allcomp = d3.selectAll("rect.CompBody")
                .on('mousedown', function (d, i) {
                    var coordinates = d3.mouse(this);
                    componentClickX = coordinates[0];
                    componentClickY = coordinates[1];

                    clicked = true;
                    var pos = $("#comp-" + this.id).attr("transform").split("translate(")[1].replace(")",
                        "").split(",").map(function (item) {
                        return parseFloat(item, 10);
                    });
                    dragX = pos[0] + x;
                    dragY = pos[1] + y;

                    startDrag = true;
                    clickedId = this.id;
                    rectType = "component";
                    ////console.log(rectType)
                })

                handleEdgeInitialization();
                handleComponentSelection();
                HandleDoubleClick();

        });


/*
───────────────────────────────────────────────────────────────────────────────────────────
─██████████████─██████████████─██████████████─██████████████─██████─────────██████████████─
─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░██─────────██░░░░░░░░░░██─
─██████░░██████─██░░██████░░██─██░░██████████─██░░██████████─██░░██─────────██░░██████████─
─────██░░██─────██░░██──██░░██─██░░██─────────██░░██─────────██░░██─────────██░░██─────────
─────██░░██─────██░░██──██░░██─██░░██─────────██░░██─────────██░░██─────────██░░██████████─
─────██░░██─────██░░██──██░░██─██░░██──██████─██░░██──██████─██░░██─────────██░░░░░░░░░░██─
─────██░░██─────██░░██──██░░██─██░░██──██░░██─██░░██──██░░██─██░░██─────────██░░██████████─
─────██░░██─────██░░██──██░░██─██░░██──██░░██─██░░██──██░░██─██░░██─────────██░░██─────────
─────██░░██─────██░░██████░░██─██░░██████░░██─██░░██████░░██─██░░██████████─██░░██████████─
─────██░░██─────██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─
─────██████─────██████████████─██████████████─██████████████─██████████████─██████████████─
───────────────────────────────────────────────────────────────────────────────────────────

*/




$("button#addToggle").on('click', function (e) {

    var newcomp = addcomponent(uuidv4("C"), 0, 1);
 
            newcomp.fill = "#2c3e50";
            newcomp.Name = "False";
            one_character_width = 8;
            padding = 20;
            titleMargin = 30;
            titleMarginLeft = 30;
            newcomp.height = 20;
            newcomp.type = "toggle";

            // TODO : get the longest text in the component. and set the width based on this. 
            newcomp.width = 80;//newcomp.Name.length * one_character_width + titleMarginLeft;

            compPos = [Math.random() * 500, Math.random() * 500]
            var cont = svgContainer.append("g")
                .attr("class", "component")
                .attr("id", newcomp.GUID);

            var node = cont
                .append("g")
                .attr("class", newcomp.type + " " + newcomp.state + " " + newcomp.selection + " " + newcomp
                    .view + " " + newcomp.GUID)
                .attr("id", "comp-" + newcomp.GUID)
                .attr("transform", () => {
                    return "translate(" + compPos[0] + ", " + compPos[1] + ")";
                })

                var InputGroup = node.append('g');
            for (let index = 0; index < newcomp.inputs.length; index++) {
                var inp = InputGroup.append('circle').lower()
                    .attr("cx", "0")
                    .attr("cy", newcomp.height/2)
                    .attr("fill", "gray")//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "inputCir" + newcomp.GUID + "_" + index)
                    .attr("class", "inputCir " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.inputs[index].circle = addCircle();
                        newcomp.inputs[index].circle.element = this;
                        newcomp.inputs[index].circle.CX = 0;
                        newcomp.inputs[index].circle.CY = (index * padding + titleMargin);
                        newcomp.inputs[index].type = "input";
                        return "input";
                    });
            }


            var OutputGroup = node.append('g');
            for (let index = 0; index < newcomp.outputs.length; index++) {
                var out = OutputGroup.append('circle')
                    .attr("cx", newcomp.width)
                    .attr("cy", newcomp.height/2)
                    .attr("fill", "gray")//newcomp.fill)
                    .attr("r", "5")
                    .attr("stroke", "black")
                    .attr("stroke-width", "2")
                    .attr("id", "outputCir" + newcomp.GUID + "_" + index)
                    .attr("class", "outputCir " + newcomp.GUID + " " + index)
                    .attr("type", function () {
                        newcomp.outputs[index].circle = this;
                        newcomp.outputs[index].type = "output";
                        // //////console.log(newcomp.outputs[index]);
                        return "output";
                    }).lower();
            }

            var Dummyrect = node.append('rect')
                .attr("class", "CompBodyDummy " + newcomp.GUID)
                .attr("id", "dummyRect_"+newcomp.GUID)
                .attr("rx", "3")
                .attr("ry", "3")
                .attr("filter", "url(#f2")
                .attr("stroke-width", "1")
                .attr("stroke", "black")
                .attr("width", newcomp.width)
                .attr("height", newcomp.height)
                .attr("fill", newcomp.fill)

            

            var cirGroup = node.append('g')
                .attr("transform", () => {
                    x = newcomp.width;
                    y = newcomp.height;
                    return "translate(" + (x).toString() + "," + (y - 10).toString() + ")";
                });

            var log = cirGroup.append("text")
                .attr("id", "nodeLog" + newcomp.GUID)
                .attr("class", "nodeLog " + newcomp.GUID)
                .attr("transform", "translate(10, 10)")
                .text(newcomp.log.logText)
                .attr("fill", "black")
                .style("display", "none");


            var Titlegroup = node.append("g")
                .attr("transform", () => {
                    return "translate(0, 15)";
                });


            var Title = Titlegroup.append("text")
                .attr("class", "nodetitle node_title" + newcomp.GUID)
                .text(newcomp.Name)
                .attr("fill", "#ecf0f1")
                .attr("transform", "translate(" + (newcomp.width/2.0 - (newcomp.Name.length*4.0)).toString() +", 0)")

            var rect = node.append('rect')
                .attr("class", "CompBody " + newcomp.GUID)
                .attr("id", newcomp.GUID)
                .attr("rx", "3")
                .attr("ry", "3")
                .attr("width", newcomp.width)
                .attr("height", newcomp.height)
                .attr("fill", newcomp.fill)
                .attr("fill-opacity", "0.01")
                // .attr("filter", "url('#svgshadow')")
                .on("mouseover", function () {
                    newcomp.rect = this;
                    d3.select(newcomp.rect)
                        // .attr("fill", "#303952")
                        .attr("cursor", "pointer");
                })
                .on("mouseout", function () {
                    newcomp.rect = this;
                    d3.select(newcomp.rect).attr("fill", newcomp.fill)
                })
            allComp.push(newcomp);
            comp_input_edges[newcomp.GUID] = new Array(newcomp.inputs.length);
            comp_output_edges[newcomp.GUID] = new Array(newcomp.outputs.length);

            var mainGrid = d3.select("#mainGrid");
            var allcomp = d3.selectAll("rect.CompBody")
                .on('mousedown', function (d, i) {
                    var coordinates = d3.mouse(this);
                    componentClickX = coordinates[0];
                    componentClickY = coordinates[1];

                    clicked = true;
                    var pos = $("#comp-" + this.id).attr("transform").split("translate(")[1].replace(")",
                        "").split(",").map(function (item) {
                        return parseFloat(item, 10);
                    });
                    dragX = pos[0] + x;
                    dragY = pos[1] + y;

                    startDrag = true;
                    clickedId = this.id;
                    rectType = "component";
                    ////console.log(rectType)
                })

                handleEdgeInitialization();
                handleComponentSelection();
                HandleDoubleClick();



        });

/*
        ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
─██████████████─██████████████─██████████████─██████████─██████████████─██████──────────██████────██████─────────██████████─██████████████─██████████████─
─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░██─██░░░░░░░░░░██─██░░██████████──██░░██────██░░██─────────██░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─
─██░░██████░░██─██░░██████░░██─██████░░██████─████░░████─██░░██████░░██─██░░░░░░░░░░██──██░░██────██░░██─────────████░░████─██░░██████████─██████░░██████─
─██░░██──██░░██─██░░██──██░░██─────██░░██───────██░░██───██░░██──██░░██─██░░██████░░██──██░░██────██░░██───────────██░░██───██░░██─────────────██░░██─────
─██░░██──██░░██─██░░██████░░██─────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██──██░░██────██░░██───────────██░░██───██░░██████████─────██░░██─────
─██░░██──██░░██─██░░░░░░░░░░██─────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██──██░░██────██░░██───────────██░░██───██░░░░░░░░░░██─────██░░██─────
─██░░██──██░░██─██░░██████████─────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██──██░░██────██░░██───────────██░░██───██████████░░██─────██░░██─────
─██░░██──██░░██─██░░██─────────────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██████░░██────██░░██───────────██░░██───────────██░░██─────██░░██─────
─██░░██████░░██─██░░██─────────────██░░██─────████░░████─██░░██████░░██─██░░██──██░░░░░░░░░░██────██░░██████████─████░░████─██████████░░██─────██░░██─────
─██░░░░░░░░░░██─██░░██─────────────██░░██─────██░░░░░░██─██░░░░░░░░░░██─██░░██──██████████░░██────██░░░░░░░░░░██─██░░░░░░██─██░░░░░░░░░░██─────██░░██─────
─██████████████─██████─────────────██████─────██████████─██████████████─██████──────────██████────██████████████─██████████─██████████████─────██████─────
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
*/


        $("button#addOptionList").on('click', function (e) {

var newcomp = addcomponent(uuidv4("C"), 0, 1);

        newcomp.fill = "white";
        newcomp.Name = "Select item";
        one_character_width = 8;
        padding = 20;
        titleMargin = 30;
        titleMarginLeft = 30;
        newcomp.height = 20;
        newcomp.type = "optionList";

        // TODO : get the longest text in the component. and set the width based on this. 
        newcomp.width = 200;//newcomp.Name.length * one_character_width + titleMarginLeft;

        compPos = [Math.random() * 500, Math.random() * 500]
        var cont = svgContainer.append("g")
            .attr("class", "component")
            .attr("id", newcomp.GUID);

        var node = cont
            .append("g")
            .attr("class", newcomp.type + " " + newcomp.state + " " + newcomp.selection + " " + newcomp
                .view + " " + newcomp.GUID)
            .attr("id", "comp-" + newcomp.GUID)
            .attr("transform", () => {
                return "translate(" + compPos[0] + ", " + compPos[1] + ")";
            })

            var InputGroup = node.append('g');
        for (let index = 0; index < newcomp.inputs.length; index++) {
            var inp = InputGroup.append('circle').lower()
                .attr("cx", "0")
                .attr("cy", newcomp.height/2)
                .attr("fill", "gray")//newcomp.fill)
                .attr("r", "5")
                .attr("stroke", "black")
                .attr("stroke-width", "2")
                .attr("id", "inputCir" + newcomp.GUID + "_" + index)
                .attr("class", "inputCir " + newcomp.GUID + " " + index)
                .attr("type", function () {
                    newcomp.inputs[index].circle = addCircle();
                    newcomp.inputs[index].circle.element = this;
                    newcomp.inputs[index].circle.CX = 0;
                    newcomp.inputs[index].circle.CY = (index * padding + titleMargin);
                    newcomp.inputs[index].type = "input";
                    return "input";
                });
        }


        var OutputGroup = node.append('g');
        for (let index = 0; index < newcomp.outputs.length; index++) {
            var out = OutputGroup.append('circle')
                .attr("cx", newcomp.width)
                .attr("cy", newcomp.height/2)
                .attr("fill", "gray")//newcomp.fill)
                .attr("r", "5")
                .attr("stroke", "black")
                .attr("stroke-width", "2")
                .attr("id", "outputCir" + newcomp.GUID + "_" + index)
                .attr("class", "outputCir " + newcomp.GUID + " " + index)
                .attr("type", function () {
                    newcomp.outputs[index].circle = this;
                    newcomp.outputs[index].type = "output";
                    // //////console.log(newcomp.outputs[index]);
                    return "output";
                }).lower();
        }

        var Dummyrect = node.append('rect')
            .attr("class", "CompBodyDummy " + newcomp.GUID)
            .attr("id", "dummyRect_"+newcomp.GUID)
            .attr("rx", "3")
            .attr("ry", "3")
            .attr("filter", "url(#f2")
            .attr("stroke-width", "1")
            .attr("stroke", "black")
            .attr("width", newcomp.width)
            .attr("height", newcomp.height)
            .attr("fill", newcomp.fill)

        

        var cirGroup = node.append('g')
            .attr("transform", () => {
                x = newcomp.width;
                y = newcomp.height;
                return "translate(" + (x).toString() + "," + (y - 10).toString() + ")";
            });

        var log = cirGroup.append("text")
            .attr("id", "nodeLog" + newcomp.GUID)
            .attr("class", "nodeLog " + newcomp.GUID)
            .attr("transform", "translate(10, 10)")
            .text(newcomp.log.logText)
            .attr("fill", "black")
            .style("display", "none");


        var Titlegroup = node.append("g")
            .attr("transform", () => {
                return "translate(0, 15)";
            });


        var Title = Titlegroup.append("text")
            .attr("class", "nodetitle node_title" + newcomp.GUID)
            .attr("id", "option-"+newcomp.GUID)
            .text(newcomp.Name)
            .attr("fill", "black")
            .attr("transform", "translate(" + 20 +", 0)")//+ (newcomp.width/2.0 - (newcomp.Name.length*4.0)).toString() +", 0)")

        var rect = node.append('rect')
            .attr("class", "CompBody " + newcomp.GUID)
            .attr("id", newcomp.GUID)
            .attr("rx", "3")
            .attr("ry", "3")
            .attr("width", newcomp.width)
            .attr("height", newcomp.height)
            .attr("fill", newcomp.fill)
            .attr("fill-opacity", "0.01")
            // .attr("filter", "url('#svgshadow')")
            .on("mouseover", function () {
                newcomp.rect = this;
                d3.select(newcomp.rect)
                    // .attr("fill", "#303952")
                    .attr("cursor", "pointer");
            })
            .on("mouseout", function () {
                newcomp.rect = this;
                d3.select(newcomp.rect).attr("fill", newcomp.fill)
            })
        allComp.push(newcomp);
        comp_input_edges[newcomp.GUID] = new Array(newcomp.inputs.length);
        comp_output_edges[newcomp.GUID] = new Array(newcomp.outputs.length);

        var mainGrid = d3.select("#mainGrid");
        var allcomp = d3.selectAll("rect.CompBody")
            .on('mousedown', function (d, i) {
                var coordinates = d3.mouse(this);
                componentClickX = coordinates[0];
                componentClickY = coordinates[1];

                clicked = true;
                var pos = $("#comp-" + this.id).attr("transform").split("translate(")[1].replace(")",
                    "").split(",").map(function (item) {
                    return parseFloat(item, 10);
                });
                dragX = pos[0] + x;
                dragY = pos[1] + y;

                startDrag = true;
                clickedId = this.id;
                rectType = "component";
                ////console.log(rectType)
            })

            handleEdgeInitialization();
            handleComponentSelection();
            HandleDoubleClick();



    });
        /*
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
─██████████████─██████──██████─██████──────────██████─██████████████─██████████████─██████████─██████████████─██████──────────██████─██████████████─
─██░░░░░░░░░░██─██░░██──██░░██─██░░██████████──██░░██─██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░██─██░░░░░░░░░░██─██░░██████████──██░░██─██░░░░░░░░░░██─
─██░░██████████─██░░██──██░░██─██░░░░░░░░░░██──██░░██─██░░██████████─██████░░██████─████░░████─██░░██████░░██─██░░░░░░░░░░██──██░░██─██░░██████████─
─██░░██─────────██░░██──██░░██─██░░██████░░██──██░░██─██░░██─────────────██░░██───────██░░██───██░░██──██░░██─██░░██████░░██──██░░██─██░░██─────────
─██░░██████████─██░░██──██░░██─██░░██──██░░██──██░░██─██░░██─────────────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██──██░░██─██░░██████████─
─██░░░░░░░░░░██─██░░██──██░░██─██░░██──██░░██──██░░██─██░░██─────────────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██──██░░██─██░░░░░░░░░░██─
─██░░██████████─██░░██──██░░██─██░░██──██░░██──██░░██─██░░██─────────────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██──██░░██─██████████░░██─
─██░░██─────────██░░██──██░░██─██░░██──██░░██████░░██─██░░██─────────────██░░██───────██░░██───██░░██──██░░██─██░░██──██░░██████░░██─────────██░░██─
─██░░██─────────██░░██████░░██─██░░██──██░░░░░░░░░░██─██░░██████████─────██░░██─────████░░████─██░░██████░░██─██░░██──██░░░░░░░░░░██─██████████░░██─
─██░░██─────────██░░░░░░░░░░██─██░░██──██████████░░██─██░░░░░░░░░░██─────██░░██─────██░░░░░░██─██░░░░░░░░░░██─██░░██──██████████░░██─██░░░░░░░░░░██─
─██████─────────██████████████─██████──────────██████─██████████████─────██████─────██████████─██████████████─██████──────────██████─██████████████─
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

        */


        function updateAll() {

            allEdges.forEach(element => {
                thisD = element.path[0].attributes.d.value;
                d3.select("#" + element.path[0].id)
                    .attr("stroke-width", "3")
                    .attr("d", function () {
                        return thisD.replace("L", "C");
                    })
                    .attr("stroke-dasharray", "0")
                    .attr("stroke", "rgb(48, 57, 82)")
                    .attr("stroke-linecap", "round")
                    .attr("stroke-opacity", "0.5").lower();

                // //console.log(edge_comp_matrix)
            });
        }



        function toMoveEdgeEnds(mainObj) {
            mainObj.inputs.forEach(input => {
            });
        }

        function returnCurveString(x1, y1, x2, y2) {
            coalignValue = 150.0;
            if (x2<x1)
            {
                coalignValue = Math.abs(y2 - y1) / 2.0 + Math.abs(x2-x1);
            }else
            {
                coalignValue = Math.abs(y2 - y1) / 2.0;
            }

            ////console.log(coalignValue)
            return "M " + x1 + "," + y1 + " " +
                "C " + (((x1 + x2) / 2.0) + coalignValue).toString() + "," + y1 +
                " " + (((x1 + x2) / 2.0) - coalignValue).toString() + "," + y2 +
                " " + x2 + "," + y2;
        }

        function getlocationFromTransform(trnsformText)
        {
            return trnsformText.replace("translate(","").replace(")", "").split(",").map(function (item) {
                        return parseFloat(item, 10);
                    });
        }

        function HandleDoubleClick()
        {
            allComp.forEach(element => {
                if(element.type == "string") {
                    d3.select("g#comp-"+element.GUID)
                    .on("dblclick",function(){
                        $("text#textbody_"+element.GUID).attr("fill", "none");
                        thiselemPos = getlocationFromTransform($("g#comp-"+element.GUID).attr("transform"));
                        d3.select("#textAreaBox")
                        .style("display", "block")
                        textA = d3.select("#TextAreaSelector")
                        .text(element.textValue)
                        .style("position", "absolute")
                        .style("left", thiselemPos[0]+3+"px")
                        .style("top", thiselemPos[1]+17+"px")
                        .style("height", (parseFloat(d3.select("rect#"+element.GUID).attr("height"))-50).toString()+"px")
                        .style("width", element.width-10+"px")
                        .attr("textBodyId", element.GUID);

                        textareaStarted = true;
                        textAreaRectId = element.GUID;
                    })
                }
                else if(element.type == "optionList")
                {
                        
                    d3.select("g#comp-"+element.GUID)
                    .on("dblclick",function(){
                        d3.select("div#optionlistBox").style("display", "block")
                        $("text#option-"+element.GUID).attr("fill", "none");
                        thiselemPos = getlocationFromTransform($("g#comp-"+element.GUID).attr("transform"));
                        // //console.log($("g#comp-"+element.GUID).attr("transform"))
                        d3.select("#optionListSelectItems")
                        .style("display", "block")
                        .attr("tempId", element.GUID)
                        textA = d3.select("#optionListSelectItems")
                        .html(function()
                        {
                            text = ""
                            for(var key in element.optionListValues)
                            {
                                text += '<option value="'+element.optionListValues[key]+'">'+key+'</option>'
                            }
                            return text;
                        })
                        .style("position", "absolute")
                        .style("left", thiselemPos[0]+20+"px")
                        .style("top", thiselemPos[1]+1+"px")
                        .style("height", (parseFloat(d3.select("rect#"+element.GUID).attr("height"))-50).toString()+"px")
                        .style("width", element.width-50+"px")
                        .attr("textBodyId", element.GUID);

                        /*
                        .style("left", selectedRect[0]+20+"px")
                        .style("top", selectedRect[1]+2+"px")
                        */

                        optionListStarted = true;
                        optionlistRectid = element.GUID;
                    })
                }  else if(element.type == "toggle")
                {
                        // //console.log(element.GUID)
                    d3.select("g#comp-"+element.GUID)
                    .on("dblclick",function(){
                        toggleValue = $("text.nodetitle.node_title"+element.GUID).text();
                        d3.select("text.nodetitle.node_title"+element.GUID)
                        .text(function()
                        {
                            if (toggleValue == "True")
                            return "False"
                            else
                            return "True"
                        })
                        .attr("fill", ()=>
                        {
                            if(toggleValue == "True")
                            {
                                d3.select("#dummyRect_"+element.GUID)
                                .attr("fill", "#2c3e50")
                                return "#ecf0f1";
                            }
                            else
                            {
                                d3.select("#dummyRect_"+element.GUID)
                                .attr("fill", "#ecf0f1")
                                return "#2c3e50"
                            }
                        }
                        );
                    })
                }
                //TODO : else if other types than string, then you have to open the properties window.
                
            });
        }

        function handleComponentSelection()
        {
            allComp.forEach(element => {
                if(element.type == "component" || element.type == "string" || element.type == "toggle" || element.type == "optionList")
                {
                    d3.select("g#comp-"+element.GUID)
                .on("click",function(){
                    d3.select("rect#"+element.GUID)
                    .attr("stroke-width","2")
                    .attr("stroke", "#0064ffa8");

                    selected_component_id = element.GUID;
                })

                d3.select("rect#"+element.GUID)
                .on("focusout", ()=>
                {
                    d3.select("rect#"+element.GUID)
                    .attr("stroke-width","0")
                    .attr("stroke", "none");
                })
                }
                else if(element.type == "slider")
                {
                    //console.log("you selected a slider")
                    d3.select("rect#"+element.GUID)
                    .on("click",function(){
                        d3.select("rect#"+element.GUID)
                        .attr("stroke-width","2")
                        .attr("stroke", "#0064ffa8");
                        selected_component_id = element.GUID;
                    })
                    .on("focusout", ()=>
                    {
                        d3.select("rect#"+element.GUID)
                        .attr("stroke-width","1")
                        .attr("stroke", "black");
                    })

                }
                
            });
        }

        function handleEdgeInitialization()
        {
            //console.log(this)
            var toComponent = null;
            var fromComponent = null;
            var allCircles = d3.selectAll("circle")
                .on('mousedown', function () {
                    targetcircleId = this.id;
                    if (edgeStarted && targetcircleIN && this != fromCircle.element) {
                        // DUMMY, Nothing to do in this version. 
                    } else {
                        if (this.classList[0] == "outputCir")                        
                        {
                            if(comp_output_edges[this.classList[1]][this.classList[2]]==undefined)
                            {
                                selectedcircleId = this.id;
                            }else
                            {
                                // //console.log(comp_output_edges[this.classList[1]][this.classList[2]].length)
                                // + anotherNumber ... 
                                selectedcircleId = this.id+(comp_output_edges[this.classList[1]][this.classList[2]].length+1).toString();
                            }
                            edgeStarted = true;

                        var x = d3.event.pageX;
                        var y = d3.event.pageY;


                        initEdgex1 = x;
                        initEdgey1 = y;
                        null
                        d3.select("svg")
                            .append("path")
                            .attr("stroke-dasharray", "4")
                            .attr("d", function () {
                                ////console.log("M "+initEdgex1+" "+initEdgey1+" L "+x+" "+y);
                                return "M " + initEdgex1 + " " + initEdgey1 + " L " + x + " " + y;

                            }).attr('stroke', "black")
                            .attr("stroke-width", "3")
                            .attr("id", "Path" + selectedcircleId);
                        selectedcircleId = "Path" + selectedcircleId;
                        fromCircle.element = this;
                        }
                    }
                })
                .on("mouseover", function () {
                    targetcircleIN = true;
                })
                .on("mouseup", function () {
                    //This event is called when the mouse cursor is inside the input circle, this means that the line is now complete and ready to be created. 

                    if (edgeStarted && targetcircleIN && this != fromCircle.element) {
                        toCircle.element = this;
                        thisEdge = addEdge(fromCircle, toCircle, fromCircle.element.classList, toCircle.element.classList);
                        thisPath = d3.select("#" + selectedcircleId)
                        thisEdge.path = thisPath["_groups"][0];
                        //console.log("Hello Africa")

                        //console.log(comp_input_edges[toCircle.element.classList[1]][toCircle.element.classList[2]])

                        if (comp_input_edges[toCircle.element.classList[1]][toCircle.element.classList[2]] == undefined)
                        {
                            comp_input_edges[toCircle.element.classList[1]][toCircle.element.classList[2]] = [thisEdge.path[0].id]
                        } 
                        else 
                        {
                            comp_input_edges[toCircle.element.classList[1]][toCircle.element.classList[2]]
                                .push(thisEdge.path[0].id)
                        }
                        if (comp_output_edges[fromCircle.element.classList[1]][fromCircle.element.classList[2]] == undefined) 
                        {
                            comp_output_edges[fromCircle.element.classList[1]][fromCircle.element.classList[2]] = [thisEdge.path[0].id]
                        } 
                        else 
                        {
                            comp_output_edges[fromCircle.element.classList[1]][fromCircle.element.classList[2]].push(thisEdge.path[0].id)
                        }
                        edge_comp_matrix[[thisEdge.path[0].id]] = {
                                "from": fromCircle.element.classList[1],
                                "to" : toCircle.element.classList[1],
                                "from_index" : fromCircle.element.classList[2],
                                "to_index" : toCircle.element.classList[2]
                            }
                        allEdges.push(thisEdge);
                        edgeStarted = false;
                        updateAll();

        }
                });
        }

/*
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
─██████──────────██████─██████████─██████████████─██████──────────██████─██████████████─████████████████───██████████─████████████───
─██░░██████████████░░██─██░░░░░░██─██░░░░░░░░░░██─██░░██████████──██░░██─██░░░░░░░░░░██─██░░░░░░░░░░░░██───██░░░░░░██─██░░░░░░░░████─
─██░░░░░░░░░░░░░░░░░░██─████░░████─██░░██████░░██─██░░░░░░░░░░██──██░░██─██░░██████████─██░░████████░░██───████░░████─██░░████░░░░██─
─██░░██████░░██████░░██───██░░██───██░░██──██░░██─██░░██████░░██──██░░██─██░░██─────────██░░██────██░░██─────██░░██───██░░██──██░░██─
─██░░██──██░░██──██░░██───██░░██───██░░██████░░██─██░░██──██░░██──██░░██─██░░██─────────██░░████████░░██─────██░░██───██░░██──██░░██─
─██░░██──██░░██──██░░██───██░░██───██░░░░░░░░░░██─██░░██──██░░██──██░░██─██░░██──██████─██░░░░░░░░░░░░██─────██░░██───██░░██──██░░██─
─██░░██──██████──██░░██───██░░██───██░░██████░░██─██░░██──██░░██──██░░██─██░░██──██░░██─██░░██████░░████─────██░░██───██░░██──██░░██─
─██░░██──────────██░░██───██░░██───██░░██──██░░██─██░░██──██░░██████░░██─██░░██──██░░██─██░░██──██░░██───────██░░██───██░░██──██░░██─
─██░░██──────────██░░██─████░░████─██░░██──██░░██─██░░██──██░░░░░░░░░░██─██░░██████░░██─██░░██──██░░██████─████░░████─██░░████░░░░██─
─██░░██──────────██░░██─██░░░░░░██─██░░██──██░░██─██░░██──██████████░░██─██░░░░░░░░░░██─██░░██──██░░░░░░██─██░░░░░░██─██░░░░░░░░████─
─██████──────────██████─██████████─██████──██████─██████──────────██████─██████████████─██████──██████████─██████████─████████████───
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
*/
        var mainGrid = d3.select("#mainGrid")
            .style("backgroud-color", function () {
                xGrid = this.offsetLeft;
                yGrid = this.offsetTop;
                return "white";
            }).on("mousedown", ()=>
            {
                if(textareaStarted && ! startDrag)
                {
                    textareaStarted = false;

                    newText = $("textarea#TextAreaSelector").val();
                    currenttextId = $("textarea#TextAreaSelector").attr("textbodyid"); 
                    //console.log(newText)
                    //console.log(currenttextId)
                    d3.select("text#textbody_"+currenttextId)
                    .text(newText)
                    .attr("fill", "black");


                    d3.select("textarea#TextAreaSelector")
                    .text("");

                    d3.select("#textAreaBox")
                    .style("display", "none");

                    allComp.forEach(element => {
                        if(element.GUID == currenttextId)
                        {
                            element.textValue = newText;
                        }
                    });
                    
                }
                if(optionListStarted && ! startDrag)
                {
                    optionSelecto = d3.select("select#optionListSelectItems")["_groups"][0][0];
                    newText = optionSelecto.options[optionSelecto.options.selectedIndex].text;
                    //console.log(newText);
                    
                    

                    d3.select("text#option-"+optionlistRectid)
                    .text(newText)
                    .attr("fill", "black");


                    d3.select("select#optionListSelectItems")
                    .text("");

                    d3.select("#optionlistBox")
                    .style("display", "none");

                    allComp.forEach(element => {
                        if(element.GUID == currenttextId)
                        {
                            element.textValue = newText;
                        }
                    });
                    optionListStarted = false;
                }
            }
            )
            .on("keydown", function()
            {
                if (d3.event.keyCode == 46)
                {
                    //console.log("deleting " + selected_component_id);

                        comp_input_edges[selected_component_id].forEach(element => {
                            //console.log(element[0]);
                            d3.select("path#"+element[0]).remove();

                            for (let i = 0; i < allEdges.length; i++) {
                                if (element[0] == allEdges[i]["path"][0].id)
                                {
                                    allEdges.splice(i, 1)
                                }
                                // //console.log();
                            }
                            try
                            {
                                let otherComp = edge_comp_matrix[element]["from"];
                                let otherCompIndex = edge_comp_matrix[element]["from_index"];
                                comp_output_edges[otherComp][otherCompIndex] = undefined;
                            }catch
                            {
                                //console.log("don't do that again... :)")
                            }
                            
                        });


                        comp_output_edges[selected_component_id].forEach(element => {
                            d3.select("path#"+element).remove();
                            try
                            {
                            otherComp = edge_comp_matrix[element]["to"];
                            otherCompIndex = edge_comp_matrix[element]["to_index"];
                            comp_input_edges[otherComp][otherCompIndex] = undefined;
                            }
                            catch{
                                //console.log("don't do that again... :)")

                            }
                            
                            
                        });
                        d3.select("#"+selected_component_id).remove();
                }
            })
/*
█▀▀▀ █░░ █▀▀█ █▀▀▄ █▀▀█ █░░ 　 ▀█░█▀ █▀▀█ █▀▀█ ░▀░ █▀▀█ █▀▀▄ █░░ █▀▀ █▀▀ 
█░▀█ █░░ █░░█ █▀▀▄ █▄▄█ █░░ 　 ░█▄█░ █▄▄█ █▄▄▀ ▀█▀ █▄▄█ █▀▀▄ █░░ █▀▀ ▀▀█ 
▀▀▀▀ ▀▀▀ ▀▀▀▀ ▀▀▀░ ▀░░▀ ▀▀▀ 　 ░░▀░░ ▀░░▀ ▀░▀▀ ▀▀▀ ▀░░▀ ▀▀▀░ ▀▀▀ ▀▀▀ ▀▀▀ 
*/
            var SliderAnchorclicked = false;
            var dragX = 0;
            var dragY = 0;

            var sliderRectId = "";
            var componentClickX = 0;
            var componentClickY = 0;



            var initPos = null;
            var startDrag = false;

            clickedId = "";
            let rectType = "";
            var dragX = 0;
            var dragY = 0;

            deltaX = 0;
            deltaY = 0;
            clicked = false;

            var edgeStarted = false;
            var targetcircleIN = false;

            var selectedcircleId = "";
            var targetcircleId = "";
            var selectedSliderAnchorId = "";

            var xGrid = 0;
            var yGrid = 0;

            var initEdgex2 = 0;
            var initEdgey2 = 0;

            var componentClickX = 0;
            var componentClickY = 0;


            // text global variables.

            var textareaStarted = false;
            var textAreaRectId = "";

            var optionListStarted = false;
            var optionlistRectid = "";


            // selected component variables.
            var is_component_selected = false;
            var selected_component_id = "";

        d3.select("#mainGrid")

            .on('mousemove', function () {

                mousex = d3.event.pageX;
                mousey = d3.event.pageY;
                var x = mousex - componentClickX;
                var y = mousey - componentClickY;
                if (startDrag) {
                    thisMovingObj = d3.select("#comp-" + clickedId)
                        .attr("transform", function () {
                            return "translate(" + x + "," + y + ")"
                        });

                    allComp.forEach(element => {
                        if (element.GUID == clickedId) {
                            ////console.log(clickedId);
                            ////console.log(element.type)

                            for (let index = 0; index < comp_input_edges[clickedId]
                                .length; index++) {
                                if (comp_input_edges[clickedId][index] != undefined) {
                                    comp_input_edges[clickedId][index].forEach(inputElement => {
                                        circleindex = index;
                                        rectId = clickedId;
                                        rectpos = $("#comp-" + rectId).attr("transform")
                                            .replace("translate(", "").replace(")", "")
                                            .split(",").map(function (item) {
                                                return parseFloat(item, 10);
                                            });
                                        xy2 = $("#" + inputElement).attr("d").split(
                                            " ")[1].split(",").map(function (item) {
                                            return parseFloat(item, 10);
                                        });
                                        var thenewEdge = d3.select("#" + inputElement)
                                            .attr("d", function () 
                                                {

                                                    if(element.type == "component")
                                                {
                                                    itisthelocation = returnCurveString(
                                                        xy2[0], xy2[1], rectpos[0],
                                                        rectpos[1] + (circleindex *
                                                            padding + titleMargin));
                                                } else if (element.type == "string" || element.type == "toggle")
                                                {
                                                    itisthelocation = returnCurveString(
                                                        xy2[0],
                                                        xy2[1],
                                                        rectpos[0],
                                                        rectpos[1] + element.height/2);
                                                }

                                                    
                                                    return itisthelocation;
                                                }
                                            );
                                        }
                                    );
                                }
                            }
                            for (let index = 0; index < comp_output_edges[clickedId]
                                .length; index++) {
                                if (comp_output_edges[clickedId][index] != undefined) {
                                    comp_output_edges[clickedId][index].forEach(
                                        outputElement => {
                                            circleindex = index;
                                            rectId = clickedId;
                                            rectpos = $("#comp-" + rectId).attr("transform")
                                                .replace("translate(", "").replace(")", "")
                                                .split(",").map(function (item) {
                                                    return parseFloat(item, 10);
                                                });
                                            rectwidth = $("rect#" + rectId).attr("width");
                                            xy2 = $("#" + outputElement).attr("d").split(
                                                " ")[5].split(",").map(function (item) {
                                                return parseFloat(item, 10);
                                            });
                                            var thenewEdge = d3.select("#" + outputElement)
                                                .attr("d", function () {

                                                    if(element.type == "component")
                                                {
                                                    ////console.log(element.type)

                                                    itisthelocation = returnCurveString(
                                                        rectpos[0] + parseFloat(
                                                            rectwidth), rectpos[1] +
                                                        (circleindex * padding +
                                                            titleMargin), xy2[0],
                                                        xy2[1]);
                                                    
                                                } else if(element.type == "slider")
                                                {
                                                    ////console.log(element.type)
                                                    itisthelocation = returnCurveString(rectpos[0] + parseFloat(rectwidth),
                                                                                        rectpos[1] + 10,
                                                                                        xy2[0],
                                                                                        xy2[1]);
                                                }
                                                else if(element.type == "string" || element.type == "toggle" || element.type == "optionList")
                                                {
                                                    ////console.log(element.type)
                                                    itisthelocation = returnCurveString(rectpos[0] + parseFloat(rectwidth),
                                                                                        rectpos[1] + element.height/2,
                                                                                        xy2[0],
                                                                                        xy2[1]);
                                                }
                                                return itisthelocation;
                                                    

                                                }
                                            );
                                        }
                                    );
                                }
                            }
                        }
                    });



                }
                if (edgeStarted) {
                    d3.select("#" + selectedcircleId)
                        .attr("d", function () {
                            return "M " + initEdgex1 + "," + initEdgey1 +
                                " C " + ((mousex - 2 + initEdgex1) / 2.0 + Math.abs(mousey -
                                    initEdgey1) / 1.0).toString() + "," + (initEdgey1).toString() +
                                " " + ((mousex - 2 + initEdgex1) / 2.0 - Math.abs(mousey -
                                    initEdgey1) / 1.0).toString() + "," + (mousey - 2).toString() +
                                " " + (mousex - 2).toString() + "," + (mousey - 2).toString();

                        }).attr("fill", "none")
                        .attr("stroke-opacity", "0.2")
                        .attr("interpolate", "basis");
                }

                if (SliderAnchorclicked) {
                        var sliderLineStartingpositionX = 60;
                        var sliderLineStartingpositionY = 3.0;
                        var sliderLineEndingpositionX = 238;
                        var sliderLineEndingpositionY = 3.0;

                        var coordinates = d3.mouse(theRequiredSliderGroup);
                        componentClickX = coordinates[0];
                        componentClickY = coordinates[1];

                        sliderValue = 60;
                        sliderY1 = 100.0;                                                    // Y0
                        sliderX1 = 0.0;                                                      // X0
                        sliderX0 = 0.0;                                                     // X1
                        var ax = 100.0/(sliderLineEndingpositionX - sliderLineStartingpositionX); // Y1


                        if (componentClickX <= sliderLineStartingpositionX)
                            sliderValue = 0
                        else if(componentClickX >= sliderLineEndingpositionX)
                            sliderValue = sliderLineEndingpositionX-sliderLineStartingpositionX;
                        else 
                            sliderValue = componentClickX - sliderLineStartingpositionX;

                        d3.select("#" + sliderRectId)
                            .attr("transform", function () {
                                ////console.log(componentClickX - sliderLineStartingpositionX)
                                return "translate(" + (sliderValue).toString() + "," +sliderLineStartingpositionY+")";
                            })

                            ////console.log("#sliderValueText_"+sliderRectId.replace("SliderAnchor_",""))
                        sliderTxt = d3.select("#sliderValueText_"+sliderRectId.replace("SliderAnchor_",""))
                        .text((ax*sliderValue).toFixed(6));
                    }

                    if(textareaStarted)
                    {
                        selectedRect = getlocationFromTransform(d3.select("g#comp-"+textAreaRectId).attr("transform"));
                        textA = d3.select("#TextAreaSelector")
                        .style("position", "absolute")
                        .style("height", (parseFloat(d3.select("rect#"+textAreaRectId).attr("height"))-50).toString()+"px")
                        .style("left", selectedRect[0]+4+"px")
                        .style("top", selectedRect[1]+17+"px")
                        .style("border", "none"); 
                    }


                    if(optionListStarted)
                    {
                        //console.log(optionlistRectid);
                        selectedRect = getlocationFromTransform(d3.select("g#comp-"+optionlistRectid).attr("transform"));
                        textA = d3.select("#optionListSelectItems")
                        .style("position", "absolute")
                        .style("height", (parseFloat(d3.select("rect#"+optionlistRectid).attr("height"))-50).toString()+"px")
                        .style("left", selectedRect[0]+20+"px")
                        .style("top", selectedRect[1]+1+"px");
                        // .style("border", "none"); 
                    }
            })
            .on('mouseup', function () {
                SliderAnchorclicked = false;
                if (startDrag) {
                    startDrag = false;
                }
                if (edgeStarted) {
                    edgeStarted = false;
                    theEdge = d3.select("#" + selectedcircleId).remove();
                }
            });
    </script>

</body>

</html>